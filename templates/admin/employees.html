{% extends "base.html" %}

{% block title %}Сотрудники - Администратор{% endblock %}

{% block content %}
<div class="employees-page">
    <div class="page-header">
        <h1><i class="fas fa-user-tie"></i> Управление сотрудниками</h1>
        <a href="{{ url_for('admin_add_employee') }}" class="btn btn-success">
            <i class="fas fa-user-plus"></i> Добавить сотрудника
        </a>
    </div>

    <div class="employees-table-container">
        <table class="employees-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ФИО</th>
                    <th>Должность</th>
                    <th>Отдел</th>
                    <th>Телефон</th>
                    <th>Email</th>
                    <th>Статус</th>
                    <th>Ставка/час</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in employees %}
                <tr>
                    <td>{{ employee.id }}</td>
                    <td>{{ employee.name }}</td>
                    <td>{{ employee.position }}</td>
                    <td>{{ employee.department or '-' }}</td>
                    <td>{{ employee.phone }}</td>
                    <td>{{ employee.email }}</td>
                    <td>
                        <span class="status-badge status-{{ employee.status }}">
                            {% if employee.status == 'active' %}Активен{% endif %}
                            {% if employee.status == 'on_mission' %}В командировке{% endif %}
                            {% if employee.status == 'inactive' %}Неактивен{% endif %}
                        </span>
                    </td>
                    <td>{{ employee.hourly_rate or 0 }} руб.</td>
                    <td class="actions">
                        <a href="{{ url_for('admin_edit_employee', id=employee.id) }}" 
                           class="btn-action btn-edit" title="Редактировать">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{{ url_for('admin_delete_employee', id=employee.id) }}" 
                           class="btn-action btn-delete" 
                           onclick="return confirm('Удалить сотрудника?')" 
                           title="Удалить">
                            <i class="fas fa-trash"></i>
                        </a>
                        <button class="btn-action btn-location" 
                               onclick="updateLocation('{{ employee.id }}')" 
                               title="Обновить местоположение">
                               <i class="fas fa-map-marker-alt"></i>
                        </button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="9" style="text-align: center;">Нет сотрудников</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function updateLocation(employeeId) {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                const data = {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    location: 'Определено автоматически'
                };
                
                fetch(`/api/update_location/${employeeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    alert('Местоположение обновлено!');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Ошибка обновления местоположения');
                });
            },
            function(error) {
                alert('Не удалось получить местоположение: ' + error.message);
            }
        );
    } else {
        alert('Геолокация не поддерживается вашим браузером');
    }
}
</script>
{% endblock %}